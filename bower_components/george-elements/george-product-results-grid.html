<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/core-signals/core-signals.html">
<link rel="import" href="/bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="/bower_components/core-animated-pages/transitions/hero-transition.html">
<link rel="import" href="/bower_components/core-animated-pages/transitions/cross-fade.html">
<link rel="import" href="/bower_components/core-animated-pages/transitions/slide-from-right.html">
<link rel="import" href="/bower_components/core-animated-pages/transitions/slide-down.html">
<link rel="import" href="/bower_components/core-animated-pages/transitions/slide-up.html">
<link rel="import" href="/bower_components/core-animated-pages/transitions/tile-cascade.html">
<link rel="import" href="/bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="/bower_components/paper-dropdown/paper-dropdown.html">
<link rel="import" href="/bower_components/core-menu/core-menu.html">
<link rel="import" href="/bower_components/core-collapse/core-collapse.html">
<link rel="import" href="/bower_components/paper-item/paper-item.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/font-roboto/roboto.html">
<link href="../core-collapse/core-collapse.html" rel="import">

  <polymer-element name="george-product-results-grid" attributes="query">
  <template>

    <style>
      body{
        font-family: 'RobotoDraft', sans-serif;
      }
      /*chip*/
      .chip-container {
        position: absolute;
        right: 0;
        left: 0;
        text-align: center;
      }

      .chip {
        width:220px;
        height:280px;
        display: inline-block;
        position: relative;
        border-radius: 3px;
        margin: 4px;
        padding-top: 15px;
        padding-left: 10px;
        overflow: hidden;
        text-align: start;
        background-color: #fff;
        box-shadow: 0 2px 10px 0 rgba(0, 0, 0, 0.16);
      }

      .chip-top {
        width: 200px;
        height: 200px;
      }

      .chip-bottom {
        padding: 8px;
        line-height: 1.5;
      }

      .chip-product-title {
        font-weight: bold;
      }

      .chip-image{
        height:100%;
      }

      /*card layout*/
      .card {
        font-family: 'RobotoDraft', sans-serif;
        position: absolute;
        left:5%;
        top:10%;
        width: 90%;
        height: auto;
        border-radius: 3px;
        text-align: start;
        background: #fff;
        box-shadow: 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        background-image: linear-gradient(bottom, #FFFFFF 50%, #F44336 50%);
        background-image: -o-linear-gradient(bottom, #FFFFFF 50%, #F44336 50%);
        background-image: -moz-linear-gradient(bottom, #FFFFFF 50%, #F44336 50%);
        background-image: -webkit-linear-gradient(bottom, #FFFFFF 50%, #F44336 50%);
        background-image: -ms-linear-gradient(bottom, #FFFFFF 50%, #F44336 50%);
      }

      .card-left {
        width: 35%;
        margin-top: 2%;
        margin-left: 2%;
      }

      .card-right {
        padding: 24px;
      }
      .card-top-right{
        height:55%;
      }
      .card-description{
        padding-top: 10%;
      }

      /*card contents*/
      .card-product-title {
        color:white;
        font-size: 3em;
        width:90%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .card-clothing {
        color:white;
        font-size: 1em;
      }

      .card-price {
        color:white;
        font-size: 3em;
        padding-right: 2%;
      }

      .card-image{
        width:100%;
        height:auto;
        max-height:20%;
      }

      .paper-icon-close{
        position: absolute;
        top:0px;
        right:0px;
      }
      .basket {
        background: #FFEB3B;
      }
      .inputs{
        display: inline-block;
      }
      .input span{
        color: white;
      }
      .input{
        float:left;
      }
      paper-dropdown-menu::shadow #label, paper-dropdown-menu::shadow #arrow {
        color: white !important;
      }
      paper-dropdown-menu::shadow #label {
        width: 110px;
      }
      paper-dropdown-menu{
        background-color: inherit;
        border-bottom: 1px solid white;
      }
      paper-fab{
        background: #FFEB3B;
        color: black;
        position:absolute;
        right:3%;
        bottom:50%;
      }

      /*hidef screen layout*/
      /*card tablet layout*/
      @media screen and (min-width: 1367px) {
        .card-description{
          padding-top: 15%;
        }
      }

      /*card tablet layout*/
      @media screen and (min-width: 481px) and (max-width: 1200px) {
        .card-product-title {
          font-size: 2em !important;

        }
        .card-price {
          font-size: 2em !important;
          float:left;
        }
      }
      /*card mobile layout*/
      @media screen and (max-width: 481px) {
        .card{         
        }
        .card-product-title {
          font-size: 1em !important;
        }
        .card-price {
          font-size: 1em !important;
          float:left;
        }
        .forward-fab{
          display:none !important;
        }
        .card-description{
          padding-top: 15%;
          margin-left: -60%;
        }
      }

    </style>
    <core-animated-pages id="coreAnimatedPages" selected="{{page}}" transitions="hero-transition" on-core-animated-pages-transition-end="{{complete}}">

      <section>

        <div class="chip-container" hero-p on-tap="{{transition}}">

          <template repeat="{{filteredItems as item}}">
            <div class="chip" hero-id="{{item.product}}-{{item.clothing}}" hero?="{{selectedProduct === item }}">
              <div class="chip-top" hero-id="{{item.product}}-{{item.clothing}}-art" hero?="{{selectedProduct === item}}">
                <img class="chip-image" src="{{item.image}}"/>
              </div>
              <div class="chip-bottom">
                <div class="chip-product-title">{{item.product}}</div>
                <div class="chip-clothing">{{item.clothing}}</div>
              </div>
            </div>

          </template>

        </div>
      </section>

      <section>
        <div class="card" layout horizontal hero-id="{{selectedProduct.product}}-{{selectedProduct.clothing}}" hero>
          <paper-icon-button icon="clear" class="paper-icon-close" on-tap="{{transition}}"></paper-icon-button>
          <div class="card-left" hero-id="{{selectedProduct.product}}-{{selectedProduct.clothing}}-art" hero>
            <img class="card-image" src="{{selectedProduct.image}}"/>
          </div>
          <div class="card-right" flex two>
              <div class="card-top-right">
                <paper-fab mini icon="arrow-forward" title="arrow-forward" role="button" tabindex="0" aria-label="arrow-forward" class="forward-fab" on-tap={{forward}}></paper-fab>
                <div class="card-product-title">{{selectedProduct.product}}</div>
                <div class="card-clothing">{{selectedProduct.clothing}}</div>
                <div class="card-price">Â£{{selectedProduct.price}}</div>
                <div class="inputs">
                  <div class="input">
                  <span>Size:</span>
                  <paper-dropdown-menu label="Select a Size">
                    <paper-dropdown class="dropdown">
                      <core-menu id="clothesSize" class="menu">
                        <template repeat="{{selectedProduct.sizes}}">
                          <paper-item value="{{}}">{{}}</paper-item>
                        </template>
                      </core-menu>
                    </paper-dropdown>
                  </paper-dropdown-menu>
                  </div>
                  <div class="input">
                  <span>Quantity:</span>
                  <paper-dropdown-menu label="Select Quantity">
                    <paper-dropdown class="dropdown">
                      <core-menu id="clothesQuantity" class="menu">
                        <template repeat="{{selectedProduct.quantities}}">
                          <paper-item value="{{}}">{{}}</paper-item>
                        </template>
                      </core-menu>
                    </paper-dropdown>
                  </paper-dropdown-menu>
                  </div>
                </div>
                <div>
                  <paper-button class="basket" on-click='{{addToBasket}}'>Add to Basket</paper-button>
                </div>
              </div>
              <div flex two class="card-description">{{selectedProduct.description}} </br></br> {{selectedProduct.materials}} </br></br> {{selectedProduct.productcode}}</div>
          </div>
        </div>
      </section>

    </core-animated-pages>
    <core-ajax id="ajax" auto url="/bower_components/george-elements/profiles.json" on-core-response="{{jsonLoaded}}" handleAs="json"></core-ajax>
  </template>
  <script>

    Polymer('george-product-results-grid', {

      page: 0,

      items: [
        {
          product: 'Sporty Gingham Dress',
          clothing: 'Girls',
          type: "dress",
          price: 4,
          color: 'red',
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4],
          image:'/images/women/red1.jpg',
          description: 'Invest in a beautiful new addition to your wardrobe this season with this stunning spotty fit and flare dress. Crafted with long sleeves and an eye-catching pattern, this piece combines sophistication and style perfectly.',
          materials: ' Fabric composition: 72% Polyester, 27% Viscose, 1% Elastane ',
          productcode:  'Product Code: 4774864'
        },
        {
          product: 'Girls School 2 Pack Gingham Dress',
          clothing: 'Girls',
          type: "dress",
          price: 6,
          color: 'red',
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          image:'/images/women/red2.jpg',
          description: 'Invest in a beautiful new addition to your wardrobe this season with this stunning spotty fit and flare dress. Crafted with long sleeves and an eye-catching pattern, this piece combines sophistication and style perfectly.',
          materials: ' Fabric composition: 72% Polyester, 27% Viscose, 1% Elastane ',
          productcode:  'Product Code: 4774864'
        },
        {
          product: 'Floral Dress',
          clothing: 'Women',
          type: "dress",
          price: 3.50,
          color: 'red',
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          image:'/images/women/red3.jpg',
          description: 'Invest in a beautiful new addition to your wardrobe this season with this stunning spotty fit and flare dress. Crafted with long sleeves and an eye-catching pattern, this piece combines sophistication and style perfectly.',
          materials: ' Fabric composition: 72% Polyester, 27% Viscose, 1% Elastane ',
          productcode:  'Product Code: 4774864'
        },
        {
          product: 'Bardot Dress',
          clothing: 'Women',
          type: "dress",
          price: 10,
          color: 'red',
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          image:'/images/women/red4.jpg',
          description: 'Invest in a beautiful new addition to your wardrobe this season with this stunning spotty fit and flare dress. Crafted with long sleeves and an eye-catching pattern, this piece combines sophistication and style perfectly.',
          materials: ' Fabric composition: 72% Polyester, 27% Viscose, 1% Elastane ',
          productcode:  'Product Code: 4774864'
        },
        {
          product: 'Check Dress',
          clothing: 'Women',
          type: "dress",
          price: 8,
          color: 'red',
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          image:'/images/women/red5.jpg',
          description: 'Invest in a beautiful new addition to your wardrobe this season with this stunning spotty fit and flare dress. Crafted with long sleeves and an eye-catching pattern, this piece combines sophistication and style perfectly.',
          materials: ' Fabric composition: 72% Polyester, 27% Viscose, 1% Elastane ',
          productcode:  'Product Code: 4774864'
        },
        {
          product: 'Patterned Maternity Dress',
          clothing: 'Women',
          type: "dress",
          price: 12,
          color: 'red',
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          image:'/images/women/red6.jpg',
          description: 'Invest in a beautiful new addition to your wardrobe this season with this stunning spotty fit and flare dress. Crafted with long sleeves and an eye-catching pattern, this piece combines sophistication and style perfectly.',
          materials: ' Fabric composition: 72% Polyester, 27% Viscose, 1% Elastane ',
          productcode:  'Product Code: 4774864'
        },
        {
          product: 'Spotty Fit and Flare Dress',
          clothing: 'Women',
          type: "dress",
          price: 14,
          color: 'red',
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          image:'/images/women/red7.jpg',
          description: 'Invest in a beautiful new addition to your wardrobe this season with this stunning spotty fit and flare dress. Crafted with long sleeves and an eye-catching pattern, this piece combines sophistication and style perfectly.',
          materials: ' Fabric composition: 72% Polyester, 27% Viscose, 1% Elastane ',
          productcode:  'Product Code: 4774864'
        },
        {
          product: 'Waterfall Party Dress',
          clothing: 'Women',
          type: "dress",
          price: 12,
          color: 'red',
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          image:'/images/women/red8.jpg',
          description: 'Invest in a beautiful new addition to your wardrobe this season with this stunning spotty fit and flare dress. Crafted with long sleeves and an eye-catching pattern, this piece combines sophistication and style perfectly.',
          materials: ' Fabric composition: 72% Polyester, 27% Viscose, 1% Elastane ',
          productcode:  'Product Code: 4774864'
        },
        {
          product: 'Spot Bow Party Dress',
          clothing: 'Women',
          type: "dress",
          price: 10,
          color: 'red',
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          image:'/images/women/red9.jpg',
          description: 'Invest in a beautiful new addition to your wardrobe this season with this stunning spotty fit and flare dress. Crafted with long sleeves and an eye-catching pattern, this piece combines sophistication and style perfectly.',
          materials: ' Fabric composition: 72% Polyester, 27% Viscose, 1% Elastane ',
          productcode:  'Product Code: 4774864'
        },
        {
          product: 'Dropped Waist Crepe Dress',
          clothing: 'Women',
          type: "dress",
          price: 14,
          color: 'red',
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          image:'/images/women/red10.jpg',
          description: 'Invest in a beautiful new addition to your wardrobe this season with this stunning spotty fit and flare dress. Crafted with long sleeves and an eye-catching pattern, this piece combines sophistication and style perfectly.',
          materials: ' Fabric composition: 72% Polyester, 27% Viscose, 1% Elastane ',
          productcode:  'Product Code: 4774864'
        },
        {
          product: 'Collegiate Graphic T-shirt',
          clothing: 'Men',
          type: "tee",
          price: 5,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'white',
          image:'/images/men/G004859848.png',
          description: 'A little preppy, a little laidback and totally on-trend, this collegiate graphic tee is a great addition to your wardrobe. Crafted with cotton fabric, this cool piece is sure to become a favourite of yours.',
          materials: ' 100% cotton ',
          productcode:  'Product Code: 4859238'
        },
        {
          product: 'New York City T-shirt',
          clothing: 'Men',
          type: "tee",
          price: 5,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'red',
          image:'/images/men/G004860501.png',
          description: 'Refresh your casual wardrobe with this great New York City tee. This versatile piece is ideal for bringing a pop of colour and character to your day to day casual outfits.',
          materials: ' 100% cotton ',
          productcode:  'Product Code: 4860059'
        },
        {
          product: 'Basic Pique Polo Shirt',
          clothing: 'Men',
          type: "tee",
          price: 6,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'pink',
          image:'/images/men/G004859890.png',
          description: 'An essential in any man\'s wardrobe, this polo shirt comes in pique cotton that\'s breathable, light and easy to wash. Button it up for a smart look and try it layered for a cool weekend vibe.',
          materials: ' 100% cotton ',
          productcode:  'Product Code: 4859430'
        },
        {
          product: 'Textured Front Polo Shirt',
          clothing: 'Men',
          type: "tee",
          price: 10,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'grey',
          image:'/images/men/G004844370.png',
          description: 'Introduce a timeless classic to your wardrobe with this textured front polo shirt this season. Created with soft fabric to keep you comfy, this versatile piece is ideal for completing your casual looks with a smart spin.',
          materials: ' 100% cotton ',
          productcode:  'Product Code: 4843416'
        },
        {
          product: 'Basic Pique Polo Shirt',
          clothing: 'Men',
          type: "tee",
          price: 6,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'green',
          image:'/images/men/G004859897.png',
          description: 'An essential in any man\'s wardrobe, this polo shirt comes in pique cotton that\'s breathable, light and easy to wash. Button it up for a smart look and try it layered for a cool weekend vibe.',
          materials: ' 100% cotton ',
          productcode:  'Product Code: 4859431'
        },
        {
          product: 'V-neck T-shirt',
          clothing: 'Men',
          type: "tee",
          price: 5,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'blue',
          image:'/images/men/G004833677.png',
          description: 'Stylish staples are a must-have for every wardrobe and with this great V-neck tee youâll be set for all seasons. Created with light fabric to ensure your comfort, this trendy piece is perfect for acing those laidback and layered looks.',
          materials: ' 100% cotton ',
          productcode:  'Product Code: 4833201'
        },
        {
          product: 'Crew Neck T-shirt',
          clothing: 'Men',
          type: "tee",
          price: 5,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'white',
          image:'/images/men/G004833435.png',
          description: 'For a staple youâll be wearing year-round, invest in this stylish crew neck tee. Crafted with light fabric to ensure your comfort and with a versatile design, youâll be able to mix and match with this piece time and again.',
          materials: ' 100% cotton ',
          productcode:  'Product Code: 4833206'
        },
        {
          product: 'Straight Cut Dark Wash Jeans',
          clothing: 'Men',
          type: "jeans",
          price: 6,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'navy',
          image:'/images/men/G004650398.png',
          description: 'Classically fuss-free these dark wash jeans have been cut in a straight fit offering steadfast style that will see you through season after season.',
          materials: ' 100% cotton ',
          productcode:  'Product Code: 4544077 / 4650092'
        },
        {
          product: 'Belted Jeans',
          clothing: 'Men',
          type: "jeans",
          price: 14,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'navy',
          image:'/images/men/G004708397.png',
          description: 'Cool and casual, these belted jeans are bound to become a favourite of yours. Designed to be basic and versatile, these jeans are sure to become a staple for your casual outfits.',
          materials: ' 100% cotton ',
          productcode:  'Product Code: 4708051'
        },
        {
          product: 'Slim Fit Jeans',
          clothing: 'Men',
          type: "jeans",
          price: 10,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'navy',
          image:'/images/men/G004810235.png',
          description: 'A great new staple for your wardrobe this season, these slim fit jeans are a great investment. Highly versatile, these are bound to become the key to your casual outfits this winter.',
          materials: ' 99% Cotton, 1% Elastane ',
          productcode:  'Product Code: 4809307'
        },
        {
          product: 'Belted Dark Wash Slim Fit Jeans',
          clothing: 'Men',
          type: "jeans",
          price: 15,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'navy',
          image:'/images/men/G004810190.png',
          description: 'Invest in a great new staple with these belted dark wash slim fit jeans this winter. Created to become your go-to versatile pick, youâll be completing your outfits with these trendy jeans again and again this season.',
          materials: ' 100% Cotton ',
          productcode:  'Product Code: 4809308'
        },
        {
          product: 'Jeggings',
          clothing: 'Women',
          type: "jeans",
          price: 12,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'black',
          image:'/images/men/G004870428.png',
          description: 'Go for a stylish staple youâll be wearing year-round with these great jeggings. Crafted with soft fabric and featuring an elasticated waistband, these are a comfy alternative to jeans that youâre sure to adore.',
          materials: ' 72% Cotton, 25% Polyester, 3% Elastane ',
          productcode:  'Product Code: 4869167'
        },
        {
          product: 'Corduroy Jeggings',
          clothing: 'Women',
          type: "jeans",
          price: 14,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'red',
          image:'/images/men/G004887989.png',
          description: 'Step-up the style stakes this season with these comfy and versatile corduroy jeggings. Whether youâre heading out with friends or visiting family, these are bound to become a staple in your casual outfits.',
          materials: ' 75% Cotton, 23% Viscose, 2% Elastane ',
          productcode:  'Product Code: 4887529'
        },
        {
          product: 'Floral Skinny Jeans',
          clothing: 'Women',
          type: "jeans",
          price: 16,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'black',
          image:'/images/men/G004890866.png',
          description: 'With a magnificent medley of floral patterns, these stylish skinny jeans are a fabulous addition to your casual wardrobe. These charming bottoms are perfect for transforming your everyday outfits and adding some subtle femininity to every look.',
          materials: ' 73% Cotton, 25% Polyester, 2% Elastane ',
          productcode:  'Product Code: 4890076'
        },
        {
          product: 'Skinny Jeans',
          clothing: 'Women',
          type: "jeans",
          price: 8,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'navy',
          image:'/images/men/G004868872.png',
          description: 'Bound to become your keep-forever favourites, these skinny jeans are a stylish must-have. With a versatile design and a flattering fit, these are an indispensable staple youâll be wearing time and again.',
          materials: ' 80% Cotton, 19% Polyester, 1% Elastane ',
          productcode:  'Product Code: 4868138'
        },
        {
          product: 'Acid Wash High Waisted Skinny Jeans',
          clothing: 'Women',
          type: "jeans",
          price: 16,
          sizes: [6, 8, 10, 12, 14, 16],
          quantities: [1, 2, 3, 4, 5],
          color: 'navy',
          image:'/images/men/G004897052.png',
          description: 'Embrace your inner rocker with these cool acid wash high waisted skinny jeans. These versatile bottoms are perfect for adding an edge to every look and are guaranteed to become your go-to for an effortless stylish statement piece.',
          materials: ' 68% Cotton, 30% Polyester, 2% Elastane ',
          productcode:  'Product Code: 4896094'
        }
      ],

      selectedProduct: null,

      created: function(){

      },

      // Get the selected profile data from the cookie
      getSelectedProfileData: function() {
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == ' ') {
            c = c.substring(1);
          }
          if (c.indexOf("profileData=") != -1) {
            return JSON.parse(c.substring(12, c.length));
          }
        }
        return {
          "id": "-1"
        };
      },

      transition: function(e) {
        if (this.page === 0 && e.target.templateInstance.model.item) {
          this.selectedProduct = e.target.templateInstance.model.item;
          this.$.clothesQuantity.selected = null;
          this.page = 1;
        } else {
          this.page = 0;
        }
      },

      nextProduct: function(e) {
        for (var i = 0; i < this.items.length; i++) {
          if (this.items[i].product == this.selectedProduct.product) {
            if (i+1 < this.items.length) {
              this.selectedProduct = this.items[i+1];
            } else {
              if (i+1 == this.items.length) {
                this.selectedProduct = this.items[0];
              }
            }
            break;
          }
        }
      },

      // Get a parameter from the url
      getUrlParam: function(key) {
        var url = window.location + "";
        var parameterString = url.substring(url.indexOf("?") + 1);
        var parameters = parameterString.split("&");
        for (var i = 0; i < parameters.length; i++) {
          if (parameters[i].split("=")[0].toLowerCase() == key && parameters[i].split("=").length > 1) {
            return parameters[i].split("=")[1];
          }
        }
        return "";
      },

      jsonLoaded: function() {
        // Store the profile information in the this.profiles variable
        this.profiles = this.$.ajax.response.slice(0);

        // Get the search term and parameters to filter by from the url
        var types = this.getUrlParam("types");
        var colours = this.getUrlParam("colours");
        var profiles = this.getUrlParam("profiles");
        var searchTerm = this.getUrlParam("search");
        var clothesFilters = (types === "") ? [] : types.split(",");
        var colourFilters = (colours === "") ? [] : colours.split(",");
        var profileFilters = (profiles === "") ? [] : profiles.split(",");

        // Get the currently selected profile from the cookies
        var selectedProfile = this.getSelectedProfileData();

        // Filter down the products
        this.filteredItems = this.items;
        var that = this;
        this.filteredItems = this.items.filter(function(d, idx, array) {
          var matchesClothes = (clothesFilters.length == 0) ? true : false;
          var matchesColour = (colourFilters.length == 0) ? true : false;
          var matchesProfiles = (profileFilters.length == 0) ? true : false;

          // Does it match at least one of the clothes types detected
          for (var i = 0; i < clothesFilters.length; i++) {
            if (d.type == clothesFilters[i]) {
              matchesClothes = true;
            }
          }

          // Does it match at least one of the colours detected
          for (var i = 0; i < colourFilters.length; i++) {
            if (d.color == colourFilters[i]) {
              matchesColour = true;
            }
          }

          // Does it match the profile being used for this search (male/female, no sizes yet)
          for (var i = 0; i < profileFilters.length; i++) {
            var profile = { "id":"-1"};
            for (var j = 0; j < that.profiles.length; j++) {
              if (that.profiles[j].id == profileFilters[i]) {
                profile = that.profiles[j];
              }
            }
            if (profile.id != -1 && (d.clothing == 'Men' && profile.gender == 'm') || (d.clothing == 'Women' && profile.gender == 'f')) {

              // TODO: Add checks for sizes, need to confirm how we're going to show profiles though - if we're sticking with numbers then the profiles need to be numbers - should be s, m, l, xl etc. though
              matchesProfiles = true;
            }
          }

          // Now filter by the rest of the search terms in the title and the description
          var wordMatches = 0; var totalWords = 0;
          var searchTerms = searchTerm.split(" ");
          console.log(searchTerm);
          for (var i = 0; i < searchTerms.length && searchTerms[i] != ""; i++) {
            console.log(searchTerms[i]);
            var regex = new RegExp(searchTerms[i], 'i');
            if (regex.test(d.product) || regex.test(d.description)) {
              wordMatches++;
            }
            totalWords++;
          }


          // Check to see if matches all filters and at least 50% of the search terms matched
          return matchesClothes && matchesColour && matchesProfiles && ((wordMatches == 0 && totalWords == 0) || (wordMatches/totalWords)*100 > 50);
        });
      },

      forward: function(e) {
        this.page = 0;
        setTimeout(function() {
          this.page = 1;;
          this.nextProduct();
        }.bind(this), 300);
      },

      addToBasket: function(e, detail, sender) {
        var item = e.target.templateInstance.model.selectedProduct;
        var itemComplete = {
          product: item.product,
          price: item.price,
          image: item.image,
          sizes: item.sizes[this.$.clothesSize.selected],
          quantity: item.quantities[this.$.clothesQuantity.selected],
          unique: Math.random()
        };
        this.fire('core-signal', {name:"basket-add", data:itemComplete});
      }

    });
    var product_basket;

  </script>
  </polymer-element>
